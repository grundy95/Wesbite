"0","set.seed(5)"
"0","n=1000"
"0","reps=500"
"0","cusumMax = c()"
"0","X = purrr::rerun(reps, rnorm(n))"
"0","cusumFun = function(x){"
"0","  cumsum = purrr::accumulate(x, `+`)"
"0","  n = length(x)"
"0","  "
"0","  function(k){"
"0","    return(sqrt((k*(n-k))/n)*abs(((n/(k*(n-k)))*cumsum[[k]]) - ((1/(n-k))*cumsum[[n]])))"
"0","  }"
"0","}"
"0","cusumMaxfun = function(x){"
"0","  n = length(x)"
"0","  cusum = cusumFun(x)"
"0","  CUSUM = purrr::map_dbl(1:(n-1), ~cusum(.x))"
"0","  return(max(CUSUM))"
"0","}"
"0","cusumMax = purrr::map_dbl(X, cusumMaxfun)"
"0","threshold = round(as.numeric(quantile(cusumMax, 0.95)),2)"
"0","ggplot(mapping=aes(x=cusumMax))+"
"0","  geom_histogram()+"
"0","  geom_vline(aes(xintercept=threshold))+"
"0","  annotate(geom='text', x=threshold, y=30, label=paste0('threshold=',threshold), size=5, hjust=0)"
